## 全局负载均衡

在一般应用中，当流量比较大的时候，我们需要扩容，然后使用负载均衡来将流量进行分流。但是当服务器扩容到几万台，几百万台的时候，这时候我们就需要使用GSLB（全局负载均衡）了。

一般的全局负载均衡有如下几个方案：

#### DNS

GSLB会替代最终的DNS的服务器从而实现自己的解析策略，返回给用户最合适的IP(列表)。

![image](http://chongit.github.io/image/gslb//GSLB-DNS.png)

一个普通的DNS请求：

1. 用户提交域名
2. 客户端解析域名
3. DNS服务器解析出IP
4. 客户端请求IP
5. 返回结束

加入了GSLB的请求：

1. 提交域名
2. 客户端解析域名
3. NS解析到GSLB-
4. GSLB解析并返回IP
5. 客户端请求IP
6. 返回结束

优点：

- 使用供应商的DNS服务，一般比较稳定
- 可以根据用户的区域选择较近的服务器，即对于不同地区的用户返回不同的服务器IP，从而节省带宽，提高响应速度，增强用户体验。
- 如果服务器发生故障，可以返回备份服务器IP地址来使得服务高可用。

缺点：

* 依赖外部运营商，可能有不确定性
* 价钱较贵

#### IP Route

这种方式是第四层负载均衡，直接更改IP首部实现使用跳转，并利用IP tunneling技术实现只对请求负载均衡(响应直接返回)。

![image](http://chongit.github.io/image/gslb/vs-tun.jpg)

第四类负载均衡可以使用LVS和F5，LVS是软件负载均衡器，F5是硬件负载均衡器。它比使用Nginx或HAProxy使用第七类负载均衡器性能更好。