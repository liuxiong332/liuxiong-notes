## Numpy 问题集锦

#### Numpy索引

numpy中索引有如下几种，切片索引，bool索引，数组索引。

当索引的数组均为数组索引(包括可迭代的序列，如range)的时候，将会发生跟其他不一样的行为，例如如下代码：

```python
x = np.array([[1,  2],  [3,  4],  [5,  6]]) 
y = x[[0,1,2],  [0,1,0]]  
print y
>>> [1  4  5]
y = x[range(0,3),  [0,1,0]]  
print y
>>> [1  4  5]
```

该结果包括数组中`(0,0)`，`(1,1)`和`(2,0)`位置处的元素。这种索引也被称为花式索引。它不像其他索引通过索引0轴和1轴来返回对应的数组，而是对位组合返回相应索引的数组。

其中，切片索引将会返回其原对象的视图，而bool型索引和数组索引将会返回其copy值

由于索引可能返回是视图，也有可能是副本，因此于是对于下面代码

```python
def do_something(df):
   foo = df[['bar', 'baz']]  # Is foo a view? A copy? Nobody knows!
   # ... many lines here ...
   foo['quux'] = value       # We don't know whether this will modify df or not!
   return foo
```

numpy无法确定是否修改将会修改df，因此将会爆出`SettingWithCopy`的警告。

#### Numpy axis作用

在很多Numpy函数中都有一个axis参数，可以用来调节numpy函数计算的坐标方向。

例如如下的代码片段：

```py	thon
np.sum([[1, 0], [2, 3]], axis=1)
=> [1, 5]
```

如果不传axis参数将会计算整个numpy array，当`axis`为1时，表示在坐标轴1上计算sum值。

由此可以看出，通过不同的axis，numpy会沿着不同的方向进行操作：如果不设置，那么对所有的元素操作；如果axis=0，则沿着纵轴进行操作；axis=1，则沿着横轴进行操作。但这只是简单的二位数组，如果是多维的呢？可以总结为一句话：设axis=i，则numpy沿着第i个下标变化的放下进行操作。

#### Numpy的广播机制

Numpy的函数一般要求输入的数组维数是一样的，如果数组的维数不一样的时候，就会使用广播机制，使得输入数组的维数都是一致的。

具体规则如下：

1. 让所有输入数组都向其中shape最长的数组看齐，shape中不足的部分都通过在前面加1补齐
2. 输出数组的shape是输入数组shape的各个轴上的最大值
3. 如果输入数组的某个轴和输出数组的对应轴的长度相同或者其长度为1时，这个数组能够用来计算，否则出错
4. 当输入数组的某个轴的长度为1时，沿着此轴运算时都用此轴上的第一组值

需要注意的是，当**维度不一致的时候，将会向左补充维度**，例如下面的除法操作：

```python
np.array([[1, 2, 3], [2, 3, 4], [3, 4, 5], [5,6,7], [8,9,0]]) / [1,2,3]
```

左边的参数是一个`(5, 3)`数组，而右边的操作数是`(3,)`数组，这时候除法两边的操作数shape不一致，Numpy将会通过如下步骤保证两边数组Shape一致：

* 首先右边操作数维度少1，因此Numpy会首先扩充维度到`(1, 3)`，即`[[1,2,3]]`，这时候两边`Shape`一致了，
* 然后坐标轴0上的数组长度不一致，因此右边需要用`(1, 3)`广播到`(5, 3)`，Numpy就会在0轴上复制5个即可。