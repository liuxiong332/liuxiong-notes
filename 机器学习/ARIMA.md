# ARIMA算法

ARIMA是一种平稳序列预测方法。它要求时间序列是平稳的，即要求样本时间序列得到的拟合曲线在未来的一段时间内仍能顺着现在的形态“惯性”地延续下去。

但是现实中很多时间序列其实不是严格平稳的（平均值不变，方差不明显变化），因此我们需要使用差分法，从而使得数据变得相对平稳。差分法就是取t时刻和t-1时刻的差值组成的时间序列。

### AR（自回归模型）

AR模型是用来预测当前值和历史数值之间的关系。
$$
y_t = \mu + \sum_{i=1}^{p}r_iy_{t - i} + \epsilon
$$
$y_t$是当前值，$y_{t - i}$是历史值，$\mu$是常数项，$\epsilon$是误差项。

AR的限制如下：

1. AR使用自身数据进行预测
2. 必须具有平稳性
3. 数据之间必须具有相关性，如果相关系数小于0.5，则不宜采用
4. 只适用于预测与自身前期相关的现象

### MA（移动回归模型）

MA关注的是自回归模型中误差项的累加。
$$
y_t = \mu + \sum_{i = 1}^{q}\theta_i\epsilon_{t-i} + \epsilon
$$
移动平均法能有效消除预测中的随机误差。

### ARMA（自回归移动平均模型）

自回归模型和移动平均模型的结合。
$$
y_t = \mu + \sum_{i = 1}^{p}r_iy_{t - i} + \sum_{i = 1}^{q}\theta_i\epsilon_{t - i} + \epsilon
$$

### ARIMA（查分自回归移动平均模型）

AR是自回归，p为自回归项，MA为移动平均，q为移动平均项数，d为时间序列成为平稳时的所作的差分次数。

ARIMA是将非平稳时间序列转化为平稳时间序列，然后将因变量仅对它的滞后值以及随机误差项的现值和滞后值进行回归所建立的模型。



### 自相关系数ACF(auto correction function)

有序的随机变量序列与其自身相比较，自相关函数反映了同一序列在不同时序的取值之间的相关性
$$
ACF(k) = \frac{Var(y_t)}{Cov(y_t, y_t-k)}
$$

### 偏自相关系数PACF(partial auto correction function)

对于一个平稳AR(p)模型，求出滞后k自相关系数p(k)时，实际上得到并不是x(t)与x(t-k)之间单纯的相关关系。

x(t)同时还会受到中间k-1个随机变量x(t-1)、x(t-2)、……、x(t-k+1)的影响，而这k-1个随机变量又都和x(t-k)具有相关关系，所以自相关系数p(k)里实际掺杂了其他变量对x(t)与x(t-k)的影响。

PACF剔除了中间k-1个随机变量x(t-1)、x(t-2)、……、x(t-k+1)的干扰之后，x(t-k)对x(t)影响的相关程度。

ACF还包含了其他变量的影响，而偏自相关系数PACF是严格这两个变量之间的相关性。

### ARIMA(p, d, q)系数确定

| 模型       | ACF            | PACF           |
| ---------- | -------------- | -------------- |
| AR(p)      | 衰减趋于0      | p阶后截尾      |
| MA(q)      | q阶后截尾      | 衰减趋于0      |
| ARMA(p, q) | q阶后衰减区域9 | p阶后衰减趋于0 |

截尾：落在置信区间内（95%的点都符合该规则）

### ARIMA建模流程：
1. 将序列平稳（差分法确定d）
2. p和q阶数确定：ACF与PACF
3. ARIMA（p,d,q）

### AIC和BIC

模型选择AIC与BIC: 选择更简单的模型。

AIC赤池信息准则（Akaike Information Criterion，AIC）
$$
𝐴𝐼𝐶 = 2𝑘 − 2ln(𝐿)
$$
BIC:贝叶斯信息准则（Bayesian Information Criterion，BIC）
$$
𝐵𝐼𝐶 = 𝑘𝑙𝑛 𝑛 − 2ln(𝐿)
$$
k为模型参数个数，n为样本数量，L为似然函数

### 模型残差检验

当使用ARIMA算法，并且使用AIC和BIC作为模型选择准则进行建模之后，我们还需要确定ARIMA模型的残差是否是平均值为0且方差为常数的正态分布。

如果残差是平均值为0，方差为常数的正态分布，则这个模型是比较合适的，否则表示不适用这个模型。